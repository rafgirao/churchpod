#!/bin/bash
# Shortcut for ChurchPod Cutter

# Get the directory of this script
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

# Activate virtualenv if it exists
if [ -d "$DIR/venv" ]; then
    source "$DIR/venv/bin/activate"
fi

# Pull latest changes from GitHub (skip with --no-update)
if [[ "$*" != *"--no-update"* ]]; then
    echo "Updating ChurchPod..."
    cd "$DIR"
    git pull origin main
    echo "Installing/Updating dependencies..."
    python3 -m pip install -q -r "$DIR/config/requirements.txt"
fi

# Run the python script (filter out --no-update before passing args)
ARGS=("$@")
FILTERED_ARGS=()
for arg in "${ARGS[@]}"; do
    [[ "$arg" != "--no-update" ]] && FILTERED_ARGS+=("$arg")
done

python3 "$DIR/scripts/main.py" "${FILTERED_ARGS[@]}"
